#!/usr/bin/make -f
#Copyright © 2008 yh & lsz, released under GNU GPL, version 2 or later
#Do not edit this file, edit the original xml instead

#参数 SIMPLETEST MULTITHREADING

ifdef SIMPLETEST

endif

#基本变量定义 judge 评测的临时文件 run 编译的程序 src 代码 data 数据 result 结果
WORKDIR?=.
JUDGEDIR?=$(WORKDIR)/judge
RUNDIR?=$(WORKDIR)/run
SRCDIR?=./src
DATADIR?=./data
RESULTDIR?=./result

SHELL=/bin/sh
#shell can be a special program, for network submit
EXEC=lowsars-test

USERSRCDIR?=$(SRCDIR)/$(LOWSARS_USER)
PROBSRCDIR?=$(USERSRCDIR)/$(PROB)
ifdef PROBSRC

endif

usernames=yh lsz
#should use wildcard

u=$(foreach user,$(usernames),$(1))

SHELL=/bin/sh
BINEXT=

judge: $(RESULTDIR)/summary ;
.PHONY: judge
$(JUDGEDIR)/%.user/first.prob/.compile : LOWSARS_USER=%

$(call u,$(JUDGEDIR)/$(user).user/first.prob/.compile):
	#cd $(RUNDIR) && $(EXEC) --source=$(srcdir) --check-compile first
	mkdir -p `dirname -- "$@"`
	echo "0 0 Compiled\nno additional information" >$@
$(call u,$(JUDGEDIR)/$(user).user/first.prob/1.prepare): $(JUDGEDIR)/$(LOWSARS_USER).user/first.prob/.compile
	mkdir -p `dirname -- "$@"`
	echo "0 0 OK\ninput files ready" >$@
$(call u,$(JUDGEDIR)/$(user).user/first.prob/1.run): $(JUDGEDIR)/$(LOWSARS_USER).user/first.prob/1.prepare
	# $(SRCDIR)/$(LOWSARS_USER)/first/first$(BINEXT)
	#运行，如果失败输出到1.judge
	mkdir -p `dirname -- "$@"`
	@echo "0 0 Running Successfully\nfor point 1" >$@
$(call u,$(JUDGEDIR)/$(user).user/first.prob/1.judge): $(JUDGEDIR)/$(LOWSARS_USER).user/first.prob/1.run
	#评测
	mkdir -p `dirname -- "$@"`
	@echo "0 0 Accepted\nfor point 1" >$@
.SECONDARY: $(JUDGEDIR)/$(user).user/first.prob/.summary
$(call u,$(JUDGEDIR)/$(user).user/first.prob/.summary): $(JUDGEDIR)/$(LOWSARS_USER).user/first.prob/.compile $(JUDGEDIR)/$(LOWSARS_USER).user/first.prob/1.judge
	#结果整理
	mkdir -p `dirname -- "$@"`
	@echo "0 0 OK\n*" >$@
$(call u,$(JUDGEDIR)/$(user).user/.summary): $(JUDGEDIR)/$(LOWSARS_USER).user/first.prob/.summary
	#用户结果整理
	mkdir -p `dirname -- "$@"`
	@echo "0 0 OK\n0 *" >$@
$(RESULTDIR)/summary: $(call u,$(JUDGEDIR)/$(user).user/.summary)
	#囧
	mkdir -p `dirname -- "$@"`
	@echo "lsz 0 0 *" >$@
.PHONY: judge

